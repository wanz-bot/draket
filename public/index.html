<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* =========================
   CLEAN AI CHAT STYLE
   ========================= */
:root {
    --bg: #f4f4f4;
    --panel: #ffffff;
    --border: #ddd;
    --text: #222;
    --muted: #666;
    --accent: #2f6fed;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    background: var(--bg);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    color: var(--text);
    height: 100vh;
    display: flex;
    flex-direction: column;
}

/* HEADER */
header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--panel);
    font-weight: 600;
}

/* CHAT */
.chat {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

/* MESSAGE */
.msg {
    max-width: 780px;
    margin-bottom: 20px;
}

.user {
    margin-left: auto;
    text-align: right;
}

.name {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 4px;
}

.bubble {
    background: var(--panel);
    border: 1px solid var(--border);
    padding: 12px 14px;
    border-radius: 6px;
    line-height: 1.6;
}

/* CODE BLOCK */
pre {
    background: #0f172a;
    color: #e5e7eb;
    padding: 14px;
    border-radius: 6px;
    margin-top: 10px;
    overflow-x: auto;
    position: relative;
    font-size: 13px;
}

pre code {
    font-family: Consolas, monospace;
}

/* COPY BUTTON (only for code) */
.copy-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: var(--accent);
    color: #fff;
    border: none;
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
}

/* INPUT */
.input {
    border-top: 1px solid var(--border);
    padding: 12px;
    background: var(--panel);
    display: flex;
    gap: 10px;
}

textarea {
    flex: 1;
    resize: none;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid var(--border);
    font-family: inherit;
}

button {
    padding: 0 16px;
    border-radius: 6px;
    border: none;
    background: var(--accent);
    color: #fff;
    font-weight: 600;
    cursor: pointer;
}

/* FOOTER */
footer {
    font-size: 12px;
    padding: 6px 20px;
    color: var(--muted);
    background: var(--panel);
    border-top: 1px solid var(--border);
}
</style>
</head>

<body>

<header>AI Assistant</header>

<div class="chat" id="chat">
    <div class="msg">
        <div class="name">AI</div>
        <div class="bubble">
            Hello. Ask me anything.<br>
            If you ask for code, I will return copyable code blocks.
        </div>
    </div>
</div>

<div class="input">
    <textarea id="input" rows="2" placeholder="Type here..."></textarea>
    <button id="send">Send</button>
</div>

<footer>
    chat.js status: <span id="status">checking...</span>
</footer>

<!-- KEEP chat.js -->
<script src="chat.js"></script>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");
const status = document.getElementById("status");

/* CHECK chat.js */
window.onload = () => {
    if (window.chatEngine || window.CyberChatEngine) {
        status.textContent = "loaded";
        status.style.color = "green";
    } else {
        status.textContent = "fallback mode";
        status.style.color = "red";
    }
};

/* SEND */
sendBtn.onclick = send;
input.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
    }
});

function send() {
    const text = input.value.trim();
    if (!text) return;
    addMsg("You", text, "user");
    input.value = "";

    if (window.chatEngine) {
        window.chatEngine.sendMessage(text).then(r => {
            addMsg("AI", r, "ai");
        });
    } else {
        setTimeout(() => {
            addMsg("AI",
`Here is your Python example:
```python
def hello():
    print("Hello world")
````, "ai");
        }, 700);
    }
}

/* ADD MESSAGE */
function addMsg(name, text, type) {
    const div = document.createElement("div");
    div.className = "msg " + (type === "user" ? "user" : "");
    div.innerHTML = `
        <div class="name">${name}</div>
        <div class="bubble">${format(text)}</div>
    `;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

/* FORMAT + AUTO COPY ONLY IF CODE */
function format(text) {
    text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (_, lang, code) => {
        return `
<pre>
<button class="copy-btn">COPY</button>
<code>${escapeHTML(code)}</code>
</pre>`;
    });
    return text.replace(/\n/g, "<br>");
}

function escapeHTML(str) {
    return str.replace(/</g, "&lt;").replace(/>/g, "&gt;");
}

/* COPY HANDLER */
document.addEventListener("click", e => {
    if (e.target.classList.contains("copy-btn")) {
        const code = e.target.nextElementSibling.innerText;
        navigator.clipboard.writeText(code);
        e.target.textContent = "COPIED";
        setTimeout(() => e.target.textContent = "COPY", 1000);
    }
});
</script>

</body>
</html>
