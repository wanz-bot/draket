<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CYBER AI – WormGPT Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===============================
   WORMGPT / TERMINAL STYLE
   =============================== */
:root {
    --bg: #050505;
    --panel: #0b0b0b;
    --border: #00ff6644;
    --green: #00ff66;
    --text: #eaeaea;
    --muted: #777;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: Consolas, "Courier New", monospace;
    font-size: 14px;
    height: 100vh;
}

/* HEADER */
header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    background: #000;
}

header h1 {
    color: var(--green);
    font-size: 16px;
}

/* CHAT CONTAINER */
.chat {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 120px);
}

.messages {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
}

/* MESSAGE */
.message {
    margin-bottom: 14px;
    border-left: 3px solid #444;
    padding-left: 10px;
}

.user {
    border-color: var(--green);
}

.assistant {
    border-color: #888;
}

.name {
    font-weight: bold;
    margin-bottom: 4px;
}

.user .name {
    color: var(--green);
}

.assistant .name {
    color: #aaa;
}

.content {
    line-height: 1.6;
}

/* CODE BLOCK */
pre {
    background: #000;
    border: 1px solid var(--border);
    padding: 12px;
    margin-top: 8px;
    overflow-x: auto;
    position: relative;
}

pre code {
    color: var(--green);
    font-size: 13px;
}

.copy-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    background: var(--green);
    color: #000;
    border: none;
    font-size: 11px;
    padding: 3px 8px;
    cursor: pointer;
}

/* INPUT */
.input-area {
    display: flex;
    gap: 10px;
    padding: 12px;
    border-top: 1px solid var(--border);
    background: #000;
}

textarea {
    flex: 1;
    background: #000;
    color: var(--text);
    border: 1px solid var(--border);
    padding: 10px;
    resize: none;
    font-family: inherit;
}

button {
    background: var(--green);
    border: none;
    padding: 10px 16px;
    cursor: pointer;
    font-weight: bold;
}

/* FOOTER */
footer {
    padding: 8px 16px;
    font-size: 12px;
    color: var(--muted);
    border-top: 1px solid var(--border);
    background: #000;
}
</style>
</head>

<body>

<header>
    <h1>CYBER AI — WormGPT Style</h1>
</header>

<div class="chat">
    <div class="messages" id="messages">
        <div class="message assistant">
            <div class="name">CYBER AI</div>
            <div class="content">
                System online.<br>
                Type anything or send code using <code>```</code>
            </div>
        </div>
    </div>

    <div class="input-area">
        <textarea id="input" rows="2" placeholder="Type here... (Enter = send)"></textarea>
        <button id="send">SEND</button>
    </div>
</div>

<footer>
    chat.js status: <span id="status">CHECKING...</span>
</footer>

<!-- KEEP chat.js -->
<script src="chat.js"></script>

<script>
const messages = document.getElementById("messages");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");
const status = document.getElementById("status");

/* CHECK chat.js */
window.onload = () => {
    if (window.chatEngine || window.CyberChatEngine) {
        status.textContent = "LOADED";
        status.style.color = "#00ff66";
    } else {
        status.textContent = "NOT FOUND (fallback mode)";
        status.style.color = "red";
    }
};

/* SEND */
sendBtn.onclick = send;
input.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
    }
});

function send() {
    const text = input.value.trim();
    if (!text) return;
    addMessage("YOU", text, "user");
    input.value = "";

    if (window.chatEngine) {
        window.chatEngine.sendMessage(text).then(r => {
            addMessage("CYBER AI", r, "assistant");
        });
    } else {
        setTimeout(() => {
            addMessage("CYBER AI", "Response processed.\n```python\nprint('Hello WormGPT')\n```", "assistant");
        }, 700);
    }
}

/* MESSAGE RENDER */
function addMessage(name, text, type) {
    const div = document.createElement("div");
    div.className = `message ${type}`;
    div.innerHTML = `
        <div class="name">${name}</div>
        <div class="content">${format(text)}</div>
    `;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

/* FORMAT + CODE BLOCK + COPY */
function format(text) {
    text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (_, lang, code) => {
        return `
        <pre>
            <button class="copy-btn">COPY</button>
            <code>${escape(code)}</code>
        </pre>`;
    });
    return text.replace(/\n/g, "<br>");
}

function escape(str) {
    return str.replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

/* COPY BUTTON */
document.addEventListener("click", e => {
    if (e.target.classList.contains("copy-btn")) {
        const code = e.target.nextElementSibling.innerText;
        navigator.clipboard.writeText(code);
        e.target.textContent = "COPIED";
        setTimeout(() => e.target.textContent = "COPY", 1200);
    }
});
</script>

</body>
</html>
